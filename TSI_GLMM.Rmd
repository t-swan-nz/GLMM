Loading packages
```{r}
library(qtl)
library(ggplot2)
library(pscl)
library(boot)
library(psych) 
library(stats) 
library(MASS)
library(car)
library(lmtest)
library(lme4)
library(tidyverse)
library(plyr)
library(tibble)
library(readxl)
library(aods3)
library(emmeans)
library(MuMIn)
```

Importing the data
```{r}
TSI_data <- read.csv(file = "TSI_data.csv")
```

Running a GLMM with binomial family 

```{r}
albo_binomial_2_rand_effect <- glmer(sugar ~ time + sex + habitat + (1|day) + (1|station), family = binomial, data = TSI_data)
summary(albo_binomial_2_rand_effect)
Anova(albo_binomial_2_rand_effect)

#the binomial models has a lower AIC.

r.squaredGLMM(albo_binomial_2_rand_effect)

#The model as a whole gives very good prediction of individual responses, in this case almost all the predictive value comes from the random effects rather than the fixed effects 
#testing for overdispersion with the negative binomial model

overdisp_NB <- gof(albo_binomial_2_rand_effect)
sum(residuals(overdisp_NB,"pearson")^2)

#tukey post hoc test

Tukey_sugar_NB <- emmeans(albo_binomial_2_rand_effect, list(pairwise ~ time), adjust = "tukey")
confint(Tukey_sugar_NB, level = 0.95)

Tukey_sugar_NB

#significant difference between time of day. But what if we only want to test this effect for males or ONLY for females?
#Maybe we need to flesh this out as two datasets: 1 for females, 1 for males. 

#option 1: Include a dataset where only mosquitoes that were sugar fed were included in the analysis (to further understand factors indlucing the magnitude of sugar feeding). Call this: "TSI_data_positive"

#option 2: split this by male and female.

```

Running a GLMM with a poisson family
```{r}

#try with just one random effect:

albo_poisson_glmer_2_rand_effect <- glmer(sugar ~  time + sex + habitat + (1|day) + (1|station), family = poisson, data = TSI_data)
summary(albo_poisson_glmer_2_rand_effect)
Anova(albo_poisson_glmer_2_rand_effect)

#looks like just time of day is significantly different.

r.squaredGLMM(albo_poisson_glmer_2_rand_effect)

#The model as a whole gives very good prediction of individual responses, in this case almost all the predictive value comes from the random effects rather than the fixed effects 

#try a poisson model

albo_poisson_glmer_1_rand_effect <- glmer(sugar ~  time + sex + habitat + (1|day) , family = poisson, data = TSI_data)
summary(albo_poisson_glmer_1_rand_effect)
Anova(albo_poisson_glmer_1_rand_effect)

#investigate the obtain an estimate of what proportion of the variation in response was due to the fixed effects and what proportion was due to the random effects by using a “pseudo-Rsquared” function provided

r.squaredGLMM(albo_poisson_glmer_1_rand_effect)

#R2m = R2m column gives the proportion of variance in the response which is explained by the fixed effects.

#R2c = The R2c column gives the proportion explained by the model as a whole.

#The AIC weights is less for the model with two random effects. 

```

Compare the residuals between the models
```{r}



```

Fitting only the male mosquitoes
```{r}

TSI_data_male <- read.csv(file = "TSI_data_male.csv")

male_albo_binomial_2_rand_effect <- glmer(sugar ~ time + habitat + (1|day) + (1|station), family = binomial, data = TSI_data_male)
summary(male_albo_binomial_2_rand_effect)
Anova(male_albo_binomial_2_rand_effect)

#the binomial models has a lower AIC.

r.squaredGLMM(male_albo_binomial_2_rand_effect)

#The model as a whole gives very good prediction of individual responses, in this case almost all the predictive value comes from the random effects rather than the fixed effects 

#testing for overdispersion with the negative binomial model

overdisp_NB_male <- gof(male_albo_binomial_2_rand_effect)
sum(residuals(overdisp_NB_male,"pearson")^2)

#tukey post hoc test

Tukey_sugar_NB_male <- emmeans(male_albo_binomial_2_rand_effect, list(pairwise ~ time), adjust = "tukey")
confint(Tukey_sugar_NB_male, level = 0.95)

Tukey_sugar_NB_male

# significant difference between sugar fed status by time of day

```
Fitting only the female mosquitoes 

```{r}
TSI_data_female <- read.csv(file = "TSI_data_female.csv")

female_albo_binomial_2_rand_effect <- glmer(sugar ~ time + habitat + (1|day) + (1|station), family = binomial, data = TSI_data_female)
summary(female_albo_binomial_2_rand_effect)
Anova(female_albo_binomial_2_rand_effect)

#the binomial models has a lower AIC.

r.squaredGLMM(female_albo_binomial_2_rand_effect)

#The model as a whole gives very good prediction of individual responses, in this case almost all the predictive value comes from the random effects rather than the fixed effects 

#testing for overdispersion with the negative binomial model

overdisp_NB_female <- gof(female_albo_binomial_2_rand_effect)
sum(residuals(overdisp_NB_female,"pearson")^2)

#tukey post hoc test

Tukey_sugar_NB_female <- emmeans(female_albo_binomial_2_rand_effect, list(pairwise ~ time), adjust = "tukey")
confint(Tukey_sugar_NB_female, level = 0.95)

Tukey_sugar_NB_female

#this shows that the time of day was significantly different for both the males and females. 
```




